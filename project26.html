<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hour & Minute Division Master</title>
    <style>
      :root {
        --blue: #3b82f6;
        --green: #10b981;
        --red: #ef4444;
        --purple: #8b5cf6;
        --line: #334155;
      }

      * { box-sizing: border-box; }

      body {
        font-family: "Comic Sans MS", "Chalkboard SE", cursive, sans-serif;
        background: #f8fafc;
        margin: 0;
        padding: 10px;
        min-height: 100vh;
      }

      .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 1400px;
        margin: 0 auto;
        padding: 10px;
      }

      @media (min-width: 768px) { .container { flex-direction: row; padding: 20px; } }

      .sidebar { width: 100%; display: flex; flex-direction: column; gap: 15px; }
      @media (min-width: 768px) { .sidebar { width: 280px; flex-shrink: 0; } }

      .card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      #result-display {
        display: none;
        border: 4px solid var(--green);
        background: #f0fdf4;
      }

      .workspace {
        position: relative;
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        flex: 1;
        overflow-x: auto;
      }

      .math-grid {
        display: grid;
        grid-template-columns: repeat(20, 50px);
        grid-template-rows: repeat(30, 50px);
        position: relative;
        gap: 0;
        justify-content: start;
      }

      .cell {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: #1e293b;
        z-index: 2;
      }

      .math-input {
        width: 85%;
        height: 85%;
        border: 3px solid var(--blue);
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        border-radius: 8px;
        outline: none;
        background: #f8fafc;
      }

      .bracket-side {
        border-left: 6px solid var(--line);
        border-top: 6px solid var(--line);
        border-top-left-radius: 18px;
        margin-left: 60%;
      }

      .bracket-top { border-top: 6px solid var(--line); }

      .sub-line {
        border-bottom: 4px solid var(--line);
        grid-row: var(--row);
        grid-column: var(--col-start) / span var(--span);
        width: 95%;
        margin: 0 auto;
      }

      .btn-new { background: var(--blue); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; }
      .btn-hint { background: #f59e0b; color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }

      .minus-sign { color: var(--red); font-size: 36px; }
      .plus-sign { color: var(--green); font-size: 36px; }
/* 
      .drop-arrow {
        stroke: var(--blue);
        stroke-width: 3;
        fill: none;
        marker-end: url(#arrowhead);
      } */

      .label-text { font-size: 18px; color: var(--purple); font-weight: 800; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <div class="card">
          <p>Let's divide time!<br />1 Hour = 60 Minutes</p>
          <div style="display:flex; flex-direction:column; gap:10px; text-align: left;">
            <label>Hours: <input type="number" id="hours" value="8" style="width:100%; padding:8px;"></label>
            <label>Minutes: <input type="number" id="minutes" value="17" style="width:100%; padding:8px;"></label>
            <label>Divide by: <input type="number" id="divisor" value="7" style="width:100%; padding:8px;"></label>
          </div>
          <button class="btn-new" id="btn-new" style="width:100%; margin-top:15px;">Start Problem</button>
          <button class="btn-hint" id="btn-hint" style="width:100%;">ðŸ’¡ Hint</button>
        </div>
        <div id="result-display" class="card">
          <h3 style="color: var(--green);">Excellent! ðŸŽ‰</h3>
          <div id="final-val"></div>
        </div>
      </div>

      <div class="workspace">
        <svg style="position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 1;" id="svgLayer">
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--blue)" />
            </marker>
          </defs>
        </svg>
        <div class="math-grid" id="grid"></div>
      </div>
    </div>

    <script>
      (function () {
        var app = {
          idx: 0, steps: [],
          init: function () {
            this.setupEventListeners();
            this.generate();
          },
          setupEventListeners: function () {
            document.getElementById("btn-new").onclick = () => this.generate();
            document.getElementById("btn-hint").onclick = () => {
                let input = document.getElementById("active-step");
                if(input) input.placeholder = this.steps[this.idx].val;
            };
          },
          generate: function () {
            document.getElementById("result-display").style.display = "none";
            this.hours = parseInt(document.getElementById("hours").value);
            this.minutes = parseInt(document.getElementById("minutes").value);
            this.divisor = parseInt(document.getElementById("divisor").value);

            this.hoursQuotient = Math.floor(this.hours / this.divisor);
            this.hoursRemainder = this.hours % this.divisor;
            this.remainderMinutes = this.hoursRemainder * 60;
            this.totalMinutes = this.remainderMinutes + this.minutes;
            this.minutesQuotient = Math.floor(this.totalMinutes / this.divisor);
            this.minutesRemainder = this.totalMinutes % this.divisor;

            document.getElementById("grid").innerHTML = "";
            document.getElementById("svgLayer").innerHTML = document.getElementById("svgLayer").querySelector("defs").outerHTML;

            this.idx = 0; this.steps = [];
            this.calculateSteps();
            this.renderStart();
            this.next();
          },
          calculateSteps: function () {
            let hCol = 4, mCol = 10; 

            // 1. Hour Quotient
            this.steps.push({ type: "I", val: this.hoursQuotient, r: 2, c: hCol });

            // 2. Subtract Hours
            let hp = this.hoursQuotient * this.divisor;
            this.steps.push({ type: "MINUS", r: 4, c: hCol - 1 });
            String(hp).split('').forEach((v, i) => this.steps.push({ type: "I", val: v, r: 4, c: hCol + i }));
            this.steps.push({ type: "LINE", r: 4, c: hCol + String(hp).length - 1, span: String(hp).length });

            // 3. Remainder Hour Result
            String(this.hoursRemainder).split('').forEach((v, i) => this.steps.push({ type: "I", val: v, r: 5, c: hCol + i }));

            // --- PROPER ALIGNMENT LOGIC ---
            this.steps.push({ type: "TEXT", val: "Ã—", r: 5, c: hCol + 2 });
            this.steps.push({ type: "TEXT", val: "60", r: 5, c: hCol + 3 });
            this.steps.push({ type: "TEXT", val: "=", r: 5, c: hCol + 5 });

            // Calculate where the minutes end to align the 60 result above it
            let mEnd = mCol + String(this.minutes).length - 1;
            let convStr = String(this.remainderMinutes);
            
            // User inputs result (e.g., 60) aligned to the right of the MIN area
            convStr.split('').forEach((v, i) => {
                this.steps.push({ type: "I", val: v, r: 5, c: (mEnd - convStr.length + 1) + i });
            });

            // 5. Drop the original minutes underneath the 60
            this.steps.push({ type: "PLUS", r: 6, c: (mEnd - convStr.length) });
            String(this.minutes).split('').forEach((v, i) => {
                this.steps.push({ type: "DROP", fromRow: 3, targetCol: mCol + i, toR: 6, toC: mCol + i, digit: v });
            });

            // 7. Line for Addition
            let lineSpan = Math.max(convStr.length, String(this.minutes).length) + 1;
            this.steps.push({ type: "LINE", r: 6, c: mEnd, span: lineSpan });

            // 8. Total Minutes result
            let tmStr = String(this.totalMinutes);
            tmStr.split('').forEach((v, i) => {
                this.steps.push({ type: "I", val: v, r: 7, c: (mEnd - tmStr.length + 1) + i });
            });

            // 9. Minutes Quotient
            String(this.minutesQuotient).split('').forEach((v, i) => {
                this.steps.push({ type: "I", val: v, r: 2, c: mCol + i });
            });

            // 10. Subtract Final
            let mp = this.minutesQuotient * this.divisor;
            let mpStr = String(mp);
            this.steps.push({ type: "MINUS", r: 8, c: mEnd - mpStr.length });
            mpStr.split('').forEach((v, i) => this.steps.push({ type: "I", val: v, r: 8, c: (mEnd - mpStr.length + 1) + i }));
            this.steps.push({ type: "LINE", r: 8, c: mEnd, span: mpStr.length + 1 });

            // 11. Final Remainder
            this.steps.push({ type: "I", val: this.minutesRemainder, r: 9, c: mEnd });
          },
          renderStart: function () {
            const grid = document.getElementById("grid");
            this.addCell(1, 4, "HOUR").classList.add("label-text");
            this.addCell(1, 10, "MIN").classList.add("label-text");
            this.addCell(3, 2, this.divisor);
            
            let bs = document.createElement("div"); bs.className = "bracket-side"; bs.style.gridColumn = "3"; bs.style.gridRow = "3"; grid.appendChild(bs);
            let bt = document.createElement("div"); bt.className = "bracket-top"; bt.style.gridColumn = "4 / span 12"; bt.style.gridRow = "3"; grid.appendChild(bt);

            String(this.hours).split('').forEach((v, i) => this.addCell(3, 4 + i, v));
            String(this.minutes).split('').forEach((v, i) => this.addCell(3, 10 + i, v));
          },
          addCell: function (r, c, val) {
            let el = document.createElement("div"); el.className = "cell"; el.style.gridRow = r; el.style.gridColumn = c; el.innerText = val;
            document.getElementById("grid").appendChild(el);
            return el;
          },
          next: function () {
            if (this.idx >= this.steps.length) {
                document.getElementById("result-display").style.display = "block";
                document.getElementById("final-val").innerText = `${this.hoursQuotient} HOUR ${this.minutesQuotient} MIN`;
                return;
            }
            let s = this.steps[this.idx];
            if (s.type === "MINUS") { this.addCell(s.r, s.c, "âˆ’").classList.add("minus-sign"); this.idx++; this.next(); }
            else if (s.type === "PLUS") { this.addCell(s.r, s.c, "+").classList.add("plus-sign"); this.idx++; this.next(); }
            else if (s.type === "TEXT") { 
                let cell = this.addCell(s.r, s.c, s.val);
                cell.style.fontSize = "1.5rem";
                cell.style.color = "#64748b";
                this.idx++; this.next(); 
            }
            else if (s.type === "LINE") {
                let l = document.createElement("div"); l.className = "sub-line"; l.style.setProperty("--row", s.r); l.style.setProperty("--col-start", s.c - s.span + 1); l.style.setProperty("--span", s.span);
                document.getElementById("grid").appendChild(l); this.idx++; this.next();
            }
            else if (s.type === "I") {
                let container = this.addCell(s.r, s.c, "");
                let input = document.createElement("input"); input.className = "math-input"; input.id="active-step";
                input.oninput = () => { if(input.value == s.val) { container.innerText = s.val; this.idx++; this.next(); } };
                container.appendChild(input); input.focus();
            }
            else if (s.type === "DROP") { this.doArrow(s); }
          },
          doArrow: function (s) {
            let x = (s.targetCol - 1) * 50 + 25;
            let sY = (3 - 1) * 50 + 40;
            let eY = (s.toR - 1) * 50 + 10;
            let p = document.createElementNS("http://www.w3.org/2000/svg", "path");
            p.setAttribute("d", `M ${x} ${sY} L ${x} ${eY}`);
            p.setAttribute("class", "drop-arrow");
            document.getElementById("svgLayer").appendChild(p);
            setTimeout(() => { this.addCell(s.toR, s.toC, s.digit); this.idx++; this.next(); }, 400);
          }
        };
        app.init();
      })();
    </script>
  </body>
</html>